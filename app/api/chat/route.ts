import { generateText, generateObject } from "ai"
import { openai } from "@ai-sdk/openai"
import { z } from "zod"
import { NextResponse } from "next/server"
import { appKnowledgeBase } from "@/data/chatbot-app-knowledge" // Import the new knowledge base

// Define the message structure expected by the AI SDK
interface AIMessage {
  role: "user" | "assistant" | "system"
  content: string
}

// Schema for intent classification
const IntentSchema = z.object({
  category: z.enum(["‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "‡πÅ‡∏≠‡∏õ VONIX", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]),
})

// System prompt for health advice - STRONGLY IMPROVED
const HEALTH_SYSTEM_PROMPT = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ VONIX Assistant ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö

**‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:**
- **‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏ô‡∏ó‡∏µ**
- **‡∏´‡πâ‡∏≤‡∏°‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏ã‡πâ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤ "‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞/‡∏Ñ‡∏£‡∏±‡∏ö" ‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß**
- **‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î**
- **‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡∏ñ‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô**

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
- ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå
- ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ, ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á, ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡πÄ‡∏ô‡πâ‡∏ô‡∏¢‡πâ‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á
- ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
- ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô **) ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Markdown ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
- ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏î‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå`

// System prompt for intent classification (still used for more nuanced cases)
const INTENT_CLASSIFICATION_PROMPT = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ VONIX" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏£‡∏¥‡∏ö‡∏ó ‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å

**‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
1.  ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£, ‡πÇ‡∏£‡∏Ñ, ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢, ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£, ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢, ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï, ‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö, ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ‡∏ï‡πà‡∏≤‡∏á‡πÜ) ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û" ‡πÄ‡∏™‡∏°‡∏≠
2.  ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ VONIX (‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ, ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö, ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô, ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å, ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, ‡∏õ‡∏±‡∏ç‡∏´‡∏≤, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢) ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡πÅ‡∏≠‡∏õ VONIX"
3.  ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß‡∏ó‡∏≥‡πÑ‡∏á‡∏î‡∏µ" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" -> ‡πÅ‡∏≠‡∏õ VONIX
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏á" -> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏â‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏≠‡∏û‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á" -> ‡πÅ‡∏≠‡∏õ VONIX
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏â‡∏±‡∏ô‡∏õ‡πà‡∏ß‡∏¢" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "‡∏â‡∏±‡∏ô‡∏´‡∏¥‡∏ß" -> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
`

// Define critical health keywords for direct classification - UPDATED WITH ALL USER-PROVIDED TERMS
const CRITICAL_HEALTH_KEYWORDS = [
  "‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô",
  "‡∏´‡∏±‡∏ß‡πÉ‡∏à",
  "‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à",
  "‡πÑ‡∏Ç‡∏°‡∏±‡∏ô",
  "‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•",
  "‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î",
  "‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å",
  "‡πÇ‡∏£‡∏Ñ‡∏≠‡πâ‡∏ß‡∏ô",
  "‡∏ú‡∏≠‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ",
  "‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏°‡∏ß‡∏•‡∏Å‡∏≤‡∏¢",
  "BMI",
  "‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ",
  "‡∏´‡∏≠‡∏ö‡∏´‡∏∑‡∏î",
  "‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß",
  "‡πÑ‡∏°‡πÄ‡∏Å‡∏£‡∏ô",
  "‡∏ß‡∏¥‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô",
  "‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏∏‡∏ô",
  "‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô",
  "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢",
  "‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢",
  "‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö",
  "‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏¢‡∏≤‡∏Å",
  "‡∏´‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏ô‡∏¥‡∏ó",
  "‡∏´‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏•‡∏∂‡∏Å",
  "‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤",
  "‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•",
  "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î",
  "mental health",
  "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï",
  "DASS",
  "PHQ",
  "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå",
  "‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ",
  "‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏™‡∏±‡πâ‡∏ô",
  "‡∏™‡∏°‡∏≤‡∏ò‡∏¥",
  "‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏°‡∏≤‡∏Å",
  "‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß",
  "‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤",
  "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏°‡∏≤‡∏Å",
  "‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏¢",
  "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠",
  "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô",
  "‡∏´‡∏á‡∏∏‡∏î‡∏´‡∏á‡∏¥‡∏î‡∏á‡πà‡∏≤‡∏¢",
  "‡πÇ‡∏£‡∏Ñ‡∏ï‡∏±‡∏ö",
  "‡πÑ‡∏ï",
  "‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå",
  "‡∏ã‡∏µ‡∏™‡∏ï‡πå",
  "‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á",
  "‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡πÄ‡∏ï‡πâ‡∏≤‡∏ô‡∏°",
  "‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏õ‡∏≤‡∏Å‡∏°‡∏î‡∏•‡∏π‡∏Å",
  "‡∏ã‡∏µ‡∏™‡∏ï‡πå‡∏£‡∏±‡∏á‡πÑ‡∏Ç‡πà",
  "‡∏°‡∏î‡∏•‡∏π‡∏Å",
  "‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
  "‡∏õ‡∏ß‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
  "‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
  "‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô",
  "‡∏ß‡∏±‡∏¢‡∏ó‡∏≠‡∏á",
  "‡∏†‡∏≤‡∏ß‡∏∞‡∏°‡∏µ‡∏ö‡∏∏‡∏ï‡∏£‡∏¢‡∏≤‡∏Å",
  "‡∏´‡∏°‡∏≠",
  "‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å",
  "‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå",
  "‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏´‡∏°‡∏≠",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
  "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
  "‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å",
  "‡πÄ‡∏à‡πá‡∏ö‡∏ó‡πâ‡∏≠‡∏á",
  "‡∏õ‡∏ß‡∏î‡∏´‡∏•‡∏±‡∏á",
  "‡∏õ‡∏ß‡∏î‡πÄ‡∏≠‡∏ß",
  "‡∏õ‡∏ß‡∏î‡πÑ‡∏´‡∏•‡πà",
  "‡∏õ‡∏ß‡∏î‡πÄ‡∏Ç‡πà‡∏≤",
  "‡∏õ‡∏ß‡∏î‡∏Ç‡πâ‡∏≠",
  "‡∏õ‡∏ß‡∏î‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠",
  "‡∏ä‡∏≤‡πÅ‡∏Ç‡∏ô",
  "‡∏ä‡∏≤‡∏Ç‡∏≤",
  "‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á",
  "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î",
  "‡∏¢‡∏≤‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö",
  "‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô",
  "‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡∏ã‡∏µ",
  "‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡∏î‡∏µ",
  "‡πÇ‡∏≠‡πÄ‡∏°‡∏Å‡πâ‡∏≤",
  "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏™‡∏°‡∏≠‡∏á",
  "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°",
  "‡πÅ‡∏Ñ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏°",
  "‡∏ò‡∏≤‡∏ï‡∏∏‡πÄ‡∏´‡∏•‡πá‡∏Å",
  "‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô",
  "‡∏´‡∏¥‡∏ß‡∏ö‡πà‡∏≠‡∏¢",
  "‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ö‡πà‡∏≠‡∏¢",
  "‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠",
  "‡∏ï‡∏∑‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô",
  "‡∏ô‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",
  "‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á",
  "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏£‡∏á",
  "‡∏Ç‡∏µ‡πâ‡∏•‡∏∑‡∏°",
  "‡∏°‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏ô",
  "‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏≤",
  "‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÑ‡∏°‡πà‡∏≠‡∏¥‡πà‡∏°",
  "‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å",
  "‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏î",
  "‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏°",
  "‡∏õ‡πà‡∏ß‡∏¢‡∏á‡πà‡∏≤‡∏¢",
  "‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏á‡πà‡∏≤‡∏¢",
  "‡πÅ‡∏ú‡∏•‡∏´‡∏≤‡∏¢‡∏ä‡πâ‡∏≤",
  "‡πÅ‡∏ú‡∏•‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á",
  "‡∏Ñ‡∏±‡∏î‡∏à‡∏°‡∏π‡∏Å",
  "‡πÑ‡∏≠‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á",
  "‡∏°‡∏µ‡πÑ‡∏Ç‡πâ",
  "‡∏´‡∏ô‡∏≤‡∏ß‡∏™‡∏±‡πà‡∏ô",
  "‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢",
  "‡∏ó‡πâ‡∏≠‡∏á‡∏≠‡∏∑‡∏î",
  "‡∏à‡∏∏‡∏Å‡πÅ‡∏ô‡πà‡∏ô",
  "‡∏ó‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å",
  "‡∏ñ‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å",
  "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠‡∏¢",
  "‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
  "‡πÅ‡∏û‡πâ‡∏ô‡∏°‡∏ß‡∏±‡∏ß",
  "‡∏ô‡∏°‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
  "‡πÅ‡∏û‡πâ‡∏¢‡∏≤",
  "‡πÇ‡∏£‡∏Ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠",
  "‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤",
  "‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢",
  "‡πÑ‡∏ß‡∏£‡∏±‡∏™",
  "HIV",
  "HPV",
  "‡πÄ‡∏≠‡∏î‡∏™‡πå",
  "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏û‡∏®‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå",
  "‡πÇ‡∏£‡∏Ñ‡∏ï‡∏±‡∏ö‡πÅ‡∏Ç‡πá‡∏á",
  "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏Å‡πä‡∏≤‡∏ó‡πå",
  "‡πÇ‡∏£‡∏Ñ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏û‡∏£‡∏∏‡∏ô",
  "‡πÄ‡∏ö‡∏ç‡∏à‡πÄ‡∏û‡∏™",
  "‡∏´‡∏°‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥",
  "‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢",
  "‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏•‡∏∑‡∏≠‡∏î",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏†‡∏≤‡∏¢‡πÉ‡∏ô",
  "‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏Ñ‡∏ß‡∏¥‡∏î",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á",
  "‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•",
  "‡∏ï‡∏£‡∏ß‡∏à‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô",
  "‡∏õ‡πà‡∏ß‡∏¢", // ‡πÄ‡∏û‡∏¥‡πà‡∏° '‡∏õ‡πà‡∏ß‡∏¢' ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô CRITICAL_HEALTH_KEYWORDS ‡∏î‡πâ‡∏ß‡∏¢
  "‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢", // ‡πÄ‡∏û‡∏¥‡πà‡∏° '‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢' ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô CRITICAL_HEALTH_KEYWORDS ‡∏î‡πâ‡∏ß‡∏¢
]

export async function POST(req: Request) {
  try {
    // Expect an array of messages from the client
    const { messages: clientMessages } = (await req.json()) as { messages: AIMessage[] }

    // The last message is the current user's query
    const userMessageContent = clientMessages[clientMessages.length - 1].content.toLowerCase()

    // Prepare messages for AI SDK, excluding the system prompt for classification
    const conversationHistoryForAI = clientMessages.map((msg) => ({
      role: msg.role,
      content: msg.content,
    }))

    let botResponse: string
    let intentCategory: z.infer<typeof IntentSchema>["category"]

    // --- Direct classification for critical health keywords ---
    let isCriticalHealthQuery = false
    for (const keyword of CRITICAL_HEALTH_KEYWORDS) {
      if (userMessageContent.includes(keyword)) {
        isCriticalHealthQuery = true
        break
      }
    }

    if (isCriticalHealthQuery) {
      intentCategory = "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û" // Force health intent
    } else {
      // Otherwise, use AI to classify the intent
      const { object: intentClassification } = await generateObject({
        model: openai("gpt-4o"),
        system: INTENT_CLASSIFICATION_PROMPT,
        messages: conversationHistoryForAI, // Pass full history for context
        schema: IntentSchema,
      })
      intentCategory = intentClassification.category
    }

    if (intentCategory === "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û") {
      // If it's a health-related question, generate a health advice
      const { text: healthResponse } = await generateText({
        model: openai("gpt-4o"),
        system: HEALTH_SYSTEM_PROMPT,
        messages: conversationHistoryForAI, // Pass full history for context
      })
      botResponse = healthResponse
    } else if (intentCategory === "‡πÅ‡∏≠‡∏õ VONIX") {
      // Implement simple RAG for app-related questions
      let foundAppResponse = false
      for (const entry of appKnowledgeBase) {
        if (entry.keywords.some((keyword) => userMessageContent.includes(keyword))) {
          botResponse = entry.response
          foundAppResponse = true
          break
        }
      }

      if (!foundAppResponse) {
        // Fallback to AI if no specific hardcoded app response is found
        const { text: appRelatedResponse } = await generateText({
          model: openai("gpt-4o"),
          system: `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ VONIX ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ`,
          messages: conversationHistoryForAI,
        })
        botResponse = appRelatedResponse
      }
    } else {
      // If it's neither health nor app-related, provide a refusal message
      const redirectResponses = [
        `‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô VONIX Assistant ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏û‡∏Ñ‡∏£‡∏±‡∏ö! ü§ñ

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏°‡∏≤‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤:

üè• ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:
‚Ä¢ ‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÑ‡∏´‡∏°?
‚Ä¢ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û?
‚Ä¢ ‡∏™‡∏ô‡πÉ‡∏à‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢?

üì± ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô VONIX:
‚Ä¢ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
‚Ä¢ ‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
‚Ä¢ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô`,

        `‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞ VONIX ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ü©∫

‡∏°‡∏≤‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö:
üíö ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û: ‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß ‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô ‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô
üì± VONIX: ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏î‡∏π‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
ü§ñ AI: ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•

‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö! üòä`,

        `‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏Ç‡∏≠‡∏á VONIX ‡∏Ñ‡∏£‡∏±‡∏ö! üåü

‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡∏ú‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡∏π‡∏™‡∏¥:

üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
‚Ä¢ "‡πÅ‡∏≠‡∏û‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?"
‚Ä¢ "‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á?"
‚Ä¢ "‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?"

üíä ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:
‚Ä¢ "‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß‡πÅ‡∏Å‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?"
‚Ä¢ "‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ?"
‚Ä¢ "‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏î‡∏µ?"

‡∏ú‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 24/7! üöÄ`,
      ]
      botResponse = redirectResponses[Math.floor(Math.random() * redirectResponses.length)]
    }

    return NextResponse.json({ response: botResponse })
  } catch (error) {
    console.error("Error in /api/chat:", error)
    return NextResponse.json(
      { error: "‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üòÖ" },
      { status: 500 },
    )
  }
}
